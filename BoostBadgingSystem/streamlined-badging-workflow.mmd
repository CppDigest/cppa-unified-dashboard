sequenceDiagram
    autonumber
    participant FE as Frontend
    participant IPFS as IPFS Service
    participant DB as Database
    participant Minter as Minter Wallet
    participant Sol as Solana Programs
    participant Mail as Mailing Service
    participant User as User Email Inbox
    participant Claim as Claim Portal
    participant Vault as Vault Signer Service
    participant Wallet as Recipient Wallet

    FE->>IPFS: Submit user + badge payload
    IPFS-->>FE: Return URI + CID metadata
    FE->>DB: Persist issuance record (user data, URI, flags)
    FE->>Minter: Provide mint parameters (token IDs, URI, wallet/vault)

    Minter->>Sol: Sign & send mint or batch mint transaction
    Sol-->>Wallet: Mint badge to user wallet (if provided)
    Sol-->>Vault: Store badge in vault (no wallet address)
    Sol-->>DB: Emit confirmation event (tx signatures)

    Sol-->>Mail: Trigger notification payload (wallet vs vault)
    Mail-->>User: Send email (direct badge info or claim instructions)

    Note over Claim,DB: Claim portal fetches record using URI<br/>and retrieves registered email address

    User->>Mail: Initiate claim request link
    Mail-->>User: Issue one-time verification code
    User->>Claim: Submit verification code
    Claim->>DB: Validate code, rate limits, eligibility
    Claim->>User: Prompt for public wallet address
    User->>Claim: Provide new wallet address
    Claim->>DB: Update claim intent, log timestamp
    Claim->>Vault: Request signed transfer (includes URI, token ID, wallet)
    Vault->>Sol: Execute transfer transaction
    Sol-->>Wallet: Deliver claimed badge to user wallet
    Sol-->>DB: Record claim completion (tx signature, wallet)
    Mail-->>User: Send claim confirmation email

    Note over DB: Maintain full lifecycle history<br/>(metadata hash, issuance, claim attempts, completion)

